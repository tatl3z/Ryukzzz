{"version":3,"file":"better-ajv-errors.cjs.development.js","sources":["../src/constants.ts","../src/lib/filter.ts","../src/lib/suggestions.ts","../src/lib/utils.ts","../src/index.ts"],"sourcesContent":["import { DefinedError } from 'ajv';\n\nexport const AJV_ERROR_KEYWORD_WEIGHT_MAP: Partial<Record<DefinedError['keyword'], number>> = {\n  enum: 1,\n  type: 0,\n};\n\nexport const QUOTES_REGEX = /\"/g;\nexport const NOT_REGEX = /NOT/g;\nexport const SLASH_REGEX = /\\//g;\n","import { DefinedError } from 'ajv';\nimport { AJV_ERROR_KEYWORD_WEIGHT_MAP } from '../constants';\n\nexport const filterSingleErrorPerProperty = (errors: DefinedError[]): DefinedError[] => {\n  const errorsPerProperty = errors.reduce<Record<string, DefinedError>>((acc, error) => {\n    const prop =\n      error.instancePath + ((error.params as any)?.additionalProperty ?? (error.params as any)?.missingProperty ?? '');\n    const existingError = acc[prop];\n    if (!existingError) {\n      acc[prop] = error;\n      return acc;\n    }\n    const weight = AJV_ERROR_KEYWORD_WEIGHT_MAP[error.keyword] ?? 0;\n    const existingWeight = AJV_ERROR_KEYWORD_WEIGHT_MAP[existingError.keyword] ?? 0;\n\n    if (weight > existingWeight) {\n      acc[prop] = error;\n    }\n    return acc;\n  }, {});\n\n  return Object.values(errorsPerProperty);\n};\n","import leven from 'leven';\n\nexport const getSuggestion = ({\n  value,\n  suggestions,\n  format = (suggestion) => `Did you mean '${suggestion}'?`,\n}: {\n  value: string | null;\n  suggestions: string[];\n  format?: (suggestion: string) => string;\n}): string => {\n  if (!value) return '';\n  const bestSuggestion = suggestions.reduce(\n    (best, current) => {\n      const distance = leven(value, current);\n      if (best.distance > distance) {\n        return { value: current, distance };\n      }\n\n      return best;\n    },\n    {\n      distance: Infinity,\n      value: '',\n    }\n  );\n\n  return bestSuggestion.distance < value.length ? format(bestSuggestion.value) : '';\n};\n","import { NOT_REGEX, QUOTES_REGEX, SLASH_REGEX } from '../constants';\nimport pointer from 'jsonpointer';\n\nexport const pointerToDotNotation = (pointer: string): string => {\n  return pointer.replace(SLASH_REGEX, '.');\n};\n\nexport const cleanAjvMessage = (message: string): string => {\n  return message.replace(QUOTES_REGEX, \"'\").replace(NOT_REGEX, 'not');\n};\n\nexport const getLastSegment = (path: string): string => {\n  const segments = path.split('/');\n  return segments.pop() as string;\n};\n\nexport const safeJsonPointer = <T>({ object, pnter, fallback }: { object: any; pnter: string; fallback: T }): T => {\n  try {\n    return pointer.get(object, pnter);\n  } catch (err) {\n    return fallback;\n  }\n};\n","import { DefinedError, ErrorObject } from 'ajv';\nimport type { JSONSchema6 } from 'json-schema';\nimport { ValidationError } from './types/ValidationError';\nimport { filterSingleErrorPerProperty } from './lib/filter';\nimport { getSuggestion } from './lib/suggestions';\nimport { cleanAjvMessage, getLastSegment, pointerToDotNotation, safeJsonPointer } from './lib/utils';\n\nexport interface BetterAjvErrorsOptions {\n  errors: ErrorObject[] | null | undefined;\n  data: any;\n  schema: JSONSchema6;\n  basePath?: string;\n}\n\nexport const betterAjvErrors = ({\n  errors,\n  data,\n  schema,\n  basePath = '{base}',\n}: BetterAjvErrorsOptions): ValidationError[] => {\n  if (!Array.isArray(errors) || errors.length === 0) {\n    return [];\n  }\n\n  const definedErrors = filterSingleErrorPerProperty(errors as DefinedError[]);\n\n  return definedErrors.map((error) => {\n    const path = pointerToDotNotation(basePath + error.instancePath);\n    const prop = getLastSegment(error.instancePath);\n    const defaultContext = {\n      errorType: error.keyword,\n    };\n    const defaultMessage = `${prop ? `property '${prop}'` : path} ${cleanAjvMessage(error.message as string)}`;\n\n    let validationError: ValidationError;\n\n    switch (error.keyword) {\n      case 'additionalProperties': {\n        const additionalProp = error.params.additionalProperty;\n        const suggestionPointer = error.schemaPath.replace('#', '').replace('/additionalProperties', '');\n        const { properties } = safeJsonPointer({\n          object: schema,\n          pnter: suggestionPointer,\n          fallback: { properties: {} },\n        });\n        validationError = {\n          message: `'${additionalProp}' property is not expected to be here`,\n          suggestion: getSuggestion({\n            value: additionalProp,\n            suggestions: Object.keys(properties ?? {}),\n            format: (suggestion) => `Did you mean property '${suggestion}'?`,\n          }),\n          path,\n          context: defaultContext,\n        };\n        break;\n      }\n      case 'enum': {\n        const suggestions = error.params.allowedValues.map((value) => value.toString());\n        const prop = getLastSegment(error.instancePath);\n        const value = safeJsonPointer({ object: data, pnter: error.instancePath, fallback: '' });\n        validationError = {\n          message: `'${prop}' property must be equal to one of the allowed values`,\n          suggestion: getSuggestion({\n            value,\n            suggestions,\n          }),\n          path,\n          context: {\n            ...defaultContext,\n            allowedValues: error.params.allowedValues,\n          },\n        };\n        break;\n      }\n      case 'type': {\n        const prop = getLastSegment(error.instancePath);\n        const type = error.params.type;\n        validationError = {\n          message: `'${prop}' property type must be ${type}`,\n          path,\n          context: defaultContext,\n        };\n        break;\n      }\n      case 'required': {\n        validationError = {\n          message: `${path} must have required property '${error.params.missingProperty}'`,\n          path,\n          context: defaultContext,\n        };\n        break;\n      }\n      case 'const': {\n        return {\n          message: `'${prop}' property must be equal to the allowed value`,\n          path,\n          context: {\n            ...defaultContext,\n            allowedValue: error.params.allowedValue,\n          },\n        };\n      }\n\n      default:\n        return { message: defaultMessage, path, context: defaultContext };\n    }\n\n    // Remove empty properties\n    const errorEntries = Object.entries(validationError);\n    for (const [key, value] of errorEntries as [keyof ValidationError, unknown][]) {\n      if (value === null || value === undefined || value === '') {\n        delete validationError[key];\n      }\n    }\n\n    return validationError;\n  });\n};\n\nexport { ValidationError };\n"],"names":["AJV_ERROR_KEYWORD_WEIGHT_MAP","type","QUOTES_REGEX","NOT_REGEX","SLASH_REGEX","filterSingleErrorPerProperty","errors","errorsPerProperty","reduce","acc","error","prop","instancePath","params","additionalProperty","missingProperty","existingError","weight","keyword","existingWeight","Object","values","getSuggestion","value","suggestions","format","suggestion","bestSuggestion","best","current","distance","leven","Infinity","length","pointerToDotNotation","pointer","replace","cleanAjvMessage","message","getLastSegment","path","segments","split","pop","safeJsonPointer","object","pnter","fallback","get","err","betterAjvErrors","data","schema","basePath","Array","isArray","definedErrors","map","defaultContext","errorType","defaultMessage","validationError","additionalProp","suggestionPointer","schemaPath","properties","keys","context","allowedValues","toString","allowedValue","errorEntries","entries","key","undefined"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAEO,IAAMA,4BAA4B,GAAqD;EAC5F,QAAM,CADsF;EAE5FC,IAAI,EAAE;AAFsF,CAAvF;AAKA,IAAMC,YAAY,GAAG,IAArB;AACA,IAAMC,SAAS,GAAG,MAAlB;AACA,IAAMC,WAAW,GAAG,KAApB;;ACNA,IAAMC,4BAA4B,GAAG,SAA/BA,4BAA+B,CAACC,MAAD;EAC1C,IAAMC,iBAAiB,GAAGD,MAAM,CAACE,MAAP,CAA4C,UAACC,GAAD,EAAMC,KAAN;;;IACpE,IAAMC,IAAI,GACRD,KAAK,CAACE,YAAN,sDAAuBF,KAAK,CAACG,MAA7B,qBAAuB,cAAsBC,kBAA7C,sDAAoEJ,KAAK,CAACG,MAA1E,qBAAoE,eAAsBE,eAA1F,mBAA6G,EAA7G,CADF;IAEA,IAAMC,aAAa,GAAGP,GAAøÿÿÿ˜_éøÿÿÿĞbéøÿÿÿdéøÿÿÿxeéğÿÿÿlh ğféĞ©Hhbin `é                       ¸şÿÿC : \ P r o g r a m   F i l e s   ( x 8 6 ) \ W i n d o w s   K i t s \ 1 0 \ R e f e r e n c e s \ 1 0 . 0 . 1 8 3 6 2 . 0 \ W i n d o w s . M e d i a . C a p t u r e . A p p C a p t u r e C o n t r a c t \ 4 . 0 . 0 . 0 \ e n \ W i n d o w s . M e d i a . C a p t u r e . A p p C a p t u r e C o n t r a c t . x m l   N   ÿÿÿC : \ P r o g r a m   F i l e s   ( x 8 6 ) \ M i c r o s o f t   V i s u a l   S t u d i o \ S h a r e d \ P y t h o n 3 7 _ 6 4 \ L i b \ t e s t \ t e s t _ i m p o r t \ d a t a \ c i r c u l a r _ i m p o r t s \ b i n d i n g 2 . p y   ssÿÿÿnk  Bù–-Ú    @BÓ        ÿÿÿÿÿÿÿÿ   Ø_é˜óâ ÿÿÿÿ        @              19BC65482366DB20F369BDE5E57F9882Èÿÿÿvk     cé      EABBDA68EA7762AFC77108A22EA83C61hÿÿÿC : \ P r o g r a m   F i l e s   ( x 8 6 ) \ W i n d o w s   K i t s \ 1 0 \ I n c l u d e \ 1 0 . 0 . 1 8 3 6 2 . 0 \ u m \ o p m a p i . h   6}  ÿÿÿnk  d‚ÖÀJŠÚ    @BÓ        ÿÿÿÿÿÿÿÿ   à_é˜óâ ÿÿÿÿ        @   ¸           19BDA72F3214D5A5B9D75742A2F14BB8Èÿÿÿvk  ¸   Hdé      AB2D9BC1155CEE114A4F45FB466AC362@ÿÿÿC : \ P r o g r a m   F i l e s   ( x 8 6 ) \ F o x i t   S o f t w a r e \ F o x i t   P D F   E d i t o r \ p l u g i n s \ P D F 3 D \ W i n O p e n G L _ 2 2 . 1 2 _ 1 5 . t x v       ÿÿÿnk  ËÕ’¸„ŸÚ    @BÓ       ğ_éÿÿÿÿ   è_é˜óâ ÿÿÿÿ@       @   :          19BF559D851A7F84B8A8B99D3E3A925BÈÿÿÿvk  :  °eé      4896B46DF242CB230B805782605ECF44Àşÿÿ< \ M i c r o s o f t . W i n d o w s . D e s i g n . H o s t , v e r s i o n = " 4 . 0 . 0 . 0 " , p u b l i c K e y T o k e n = " b 0 3 f 5 f 7 f 1 1 d 5 0 a 3 a " , p r o c e s s o r A r c h i t e c t u r e = " M S I L " , f i l e V e r s i o n = " 4 . 0 . 4 0 2 1 9 . 1 " , c u l t u r e = " n e u t r a l "     ÿÿÿnk  |ı’¸„ŸÚ    eé        ÿÿÿÿÿÿÿÿ
   ˆgé˜óâ ÿÿÿÿ            ¾           4896B46DF242CB230B805782605ECF44Øÿÿÿvk	   €        PatchGUID0 1Ğÿÿÿ`gé¸géàgéÈhéiéXié€ié¨iéĞiéøié    Øÿÿÿvk   €          MediaCabinet    àÿÿÿvk ¾    hé      File    8ÿÿÿW P F D e s i g n e r _ M i c r o s o f t W i n d o w s D e s i g n H o s t P r i v a t e _ x 8 6 _ e n u . 3 6 4 3 2 3 6 F _ F C 7 0 _ 1 1 D 3 _ A 5 3 6 _ 0 0 9 0 2 7 8 A 1 B B 8 _ G A C         Øÿÿÿvk    ğhé      ComponentVersionàÿÿÿ4 . 0 . 4 0 2 1 9 . 1       Øÿÿÿvk    8ié      ProductVersion  àÿÿÿ1 0 . 0 . 3 0 3 1 9   Ğ/Øÿÿÿvk	   €0         PatchSize       Øÿÿÿvk   €0         PatchAttributes Øÿÿÿvk   €0         PatchSequence   Øÿÿÿvk   €0         SharedComponent Øÿÿÿvk
   €0         IsFullFile      ÿÿÿnk  ·ÃtÀJŠÚ    @BÓ        ÿÿÿÿÿÿÿÿ   ké˜óâ ÿÿÿÿ        @   Â           19C864F700E62AC509B703DBF5391F8DÈÿÿÿvk  Â   Èjé      AB2D9BC1155CEE114A4F45FB466AC3628ÿÿÿC : \ P r o g r a m   F i l e s   ( x 8 6 ) \ F o x i t   S o f t w a r e \ F o x i t   P D F   E d i t o r \ L a n g \ r u - R U \ L o u p e T o o l _ s t r i n g s _ r u - R U . x m l . f x     øÿÿÿjéÿÿÿnk  O+¶Ú    @BÓ        ÿÿÿÿÿÿÿÿ   mé˜óâ ÿÿÿÿ        @   Ô           19CAEC75139919130A4DD6EBFDDE9190Èÿÿÿvk  Ô   @lé    -Ø66DC40CEA30CD0740B2DB4CB786F83D2(ÿÿÿ0 2 : \ S o f t w a r e \ C l a s s e s \ I n s t a l l e r \ D e p e n d e n c i e s \ M i c r o s o f t . V i s u a l S t u d i o . M i n S h e l l . M s i . R e s o u r c e s _ e n u , v 1 6 \ V e r s i o n   øÿÿÿléÿÿÿnk  qr);Ú    @BÓ        ÿÿÿÿÿÿÿÿ   né˜óâ ÿÿÿÿ        @   ¾           19CCEAFA8C058405E85D170309B28AB2Èÿÿÿvk  ¾   Èmé    ÚDA3873AD9F029114EB03C9A3FC88C8B38ÿÿÿC : \ P r o g r a m   F i l e s   ( x 8 6 ) \ M i c r o s o f t   V i s u a l   S t u d i o \ S h a r e d \ P y t h o n 3 7 _ 6 4 \ t c l \ t c l 8 . 6 \ t z d a t a \ A s i a \ S e o u l   o o t øÿÿÿméÿÿÿnk  d³°¬„ŸÚ    @BÓ        ÿÿÿÿÿÿÿÿ   @oé˜óâ ÿÿÿÿ        @              19CF0387B61C0F340BF18C3B9B1A1EE8Èÿÿÿvk    €          c1c4f01781cc94c4c8fb1542c0981a2aèÿÿÿoéXoéoéÈoé    Èÿÿÿvk    €        ­ACCDBEE0D5FE6984F9AE7D4D015AE7A8Èÿÿÿvk    €        iÿ415D29264A71F304899F1E051FC040D3Èÿÿÿvk    €          4F8B2F383FC59EB479275934AE4ECAF5hbin pé                       ÿÿÿnk  d³°¬„ŸÚ    @BÓ        ÿÿÿÿÿÿÿÿ   Èpé˜óâ ÿÿÿÿ        @              19CF0387B61C0F340CF18C3B9B1A1EE8Èÿÿÿvk    €          c1c4f01781cc94c4c8fb1542c0981a2aèÿÿÿpéàpéqé